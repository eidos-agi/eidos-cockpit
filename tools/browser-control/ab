#!/usr/bin/env bash
# ab â€” agent-browser wrapper with logging
# Usage: ./ab <agent-browser args>
# Logs every command + output to logs/YYYY-MM-DD.log

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
LOG_DIR="$SCRIPT_DIR/logs"
LOG_FILE="$LOG_DIR/$(date +%Y-%m-%d).log"
AB="$SCRIPT_DIR/node_modules/.bin/agent-browser"

mkdir -p "$LOG_DIR"

timestamp() { date '+%Y-%m-%d %H:%M:%S'; }

# Log the command
echo "[$(timestamp)] CMD: agent-browser $*" >> "$LOG_FILE"

# Run and capture output, tee to both stdout and log
OUTPUT=$("$AB" "$@" 2>&1) || true
echo "$OUTPUT"
echo "[$(timestamp)] OUT: $(echo "$OUTPUT" | head -100)" >> "$LOG_FILE"
echo "---" >> "$LOG_FILE"
